{"version":3,"sources":["style.js","App.js","index.js"],"names":["Wrapper","styled","div","LeftWrapper","RightWrapper","StrokeShow","StrokeNameList","CharacterWrapper","FunctionWrapper","HistoryWrapper","Character","ButtonWrapper","TitleTextSpan","span","TitleTextSpan2","ContextRegularSpan","ImageContainer","TitleWrapper","DataSetTitle","TextRegular","text","App","canvasRef","useRef","useState","currentStroke","setCurrentStroke","currentChar","setCurrentChar","strokeList","setStrokeList","strokeIndex","setStrokeIndex","strokeCompleted","setStrokeCompleted","systemInfo","setSystemInfo","result","setResult","tempPoints","addPoints","currentAuthor","setCurrentAuthor","total","setTotal","fullComplete","setFullComplete","submitSuccess","setSubmitSuccess","sysInfoLoading","setSysInfoLoading","currentCharLoading","setCurrentCharLoading","strokeListLoading","setStrokeListLoading","submitLoading","setSubmitLoading","saveLoading","setSaveLoading","canvasClear","useCallback","current","getContext","clearRect","useEffect","a","axios","reqResult","data","currentImageId","img","author","cId","strokesData","strokes","find","stroke","id","message","success","console","log","nextStroke","warning","length","strokeOrderLength","thisStroke","name","record","reStartChar","submitChar","skip","myDate","Date","ans","dataSetId","charId","charName","date","toLocaleString","post","useHotkeys","style","margin","status","title","extra","placement","type","onClick","setTimeout","window","location","reload","fontSize","tip","description","Group","value","size","buttonStyle","map","item","Button","height","width","padding","border","borderRadius","borderTop","percent","steps","showInfo","bordered","Item","label","src","strokeOrderImageUrl","placeholder","prefix","UserOutlined","onChange","e","target","alt","left","position","fileName","ref","error","canvas","getBoundingClientRect","top","x","clientX","y","clientY","ctx","lineWidth","beginPath","arc","Math","PI","strokeStyle","fillStyle","Paint","disabled","danger","borderBottom","overflow","index","display","flexDirection","alignItems","item2","index2","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.42aaa33b.chunk.js","sourcesContent":["import styled from 'styled-components';\r\n\r\nexport const Wrapper = styled.div`\r\n  margin: 50px auto;\r\n  width: 1500px;\r\n  height: 800px;\r\n  border: 2px solid black;\r\n  border-radius: 20px;\r\n  display: flex;\r\n  flex-direction: row;\r\n  align-items: center;\r\n  canvas {\r\n    width: 256px;\r\n    height: 256px;\r\n    border: 2px solid black;\r\n  }\r\n`;\r\n\r\n// 左侧\r\nexport const LeftWrapper = styled.div`\r\n  width: 750px;\r\n  height: 750px;\r\n  border-right: 2px solid gray;\r\n  padding-right: 5px;\r\n  /* border-radius: 20px; */\r\n  display: flex;\r\n  flex-direction: column;\r\n  flex-wrap: wrap;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n`;\r\n\r\n// 右侧大的组件\r\nexport const RightWrapper = styled.div`\r\n  margin-left: auto;\r\n  width: 800px;\r\n  height: 750px;\r\n  /* border: 2px solid black; */\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: center;\r\n  flex-wrap: wrap;\r\n`;\r\n\r\nexport const StrokeShow = styled.div`\r\n  /* border: 1px solid red; */\r\n  /* border-top: 1px solid #C0C0C0; */\r\n  /* height: 630px; */\r\n  margin-bottom: 27px;\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: center;\r\n  align-items: center;\r\n  .text {\r\n    font-size : 25px;\r\n  }\r\n`;\r\n\r\nexport const StrokeNameList = styled.div`\r\n  display: flex;\r\n  flex-direction: row;\r\n  flex-wrap: wrap;\r\n  justify-content: center;\r\n  margin-top: 10px;\r\n  border-bottom: #C0C0C0;\r\n  width: 650px;\r\n  border: 1px solid black;\r\n  border-radius: 10px;\r\n  border-bottom: 1px solid white;\r\n`;\r\n\r\nexport const CharacterWrapper = styled.div`\r\n  width: 650px;\r\n  height: 600px;\r\n  border: 1px solid black;\r\n  border-radius: 10px;\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: center;\r\n`;\r\n\r\nexport const FunctionWrapper = styled.div`\r\n  width: 300px;\r\n  /* border: 1px solid blue; */\r\n`;\r\n\r\nexport const HistoryWrapper = styled.div`\r\n  margin: 20px;\r\n  width: 250px;\r\n  border: 1px solid gray;\r\n  border-radius: 5px;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n`;\r\n\r\nexport const Character = styled.div`\r\n  width: 300px;\r\n  height: 300px;\r\n  border: 1px solid gray;\r\n  border-radius: 5px;\r\n  position: relative;\r\n  canvas {\r\n    width: 256px;\r\n    height: 256px;\r\n    margin: 22px;\r\n    border: 0;\r\n  }\r\n  img {\r\n    width: 256px;\r\n    height: 256px;\r\n    border: 1px solid red;\r\n    margin: 22px;\r\n    z-index: -1;\r\n  }\r\n`;\r\n\r\n\r\nexport const ButtonWrapper = styled.div`\r\n  margin-top: 20px;\r\n  width: 256px;\r\n  display: flex;\r\n  flex-direction: row;\r\n  flex-wrap: wrap;\r\n  justify-content: center;\r\n  align-items: center;\r\n  Button {\r\n    margin: 5px;\r\n  }\r\n`;\r\n\r\nexport const StrokePicture = styled.div`\r\n  width: 45px;\r\n  height: 45px;\r\n  border: 2px solid #1890ff;\r\n  img {\r\n    margin: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n  }\r\n  \r\n`;\r\n\r\nexport const CurrentStrokeWrapper = styled.div`\r\n  margin: 20px;\r\n`;\r\n\r\nexport const TitleTextSpan = styled.span`\r\n  font-size: 22px;\r\n`;\r\n\r\n\r\nexport const TitleTextSpan2 = styled.span`\r\n  font-size: 20px;\r\n`;\r\n\r\nexport const ContextRegularSpan = styled.span`\r\n  font-size: 18px;\r\n  font-weight: normal;\r\n`;\r\n\r\n\r\nexport const ImageContainer = styled.div`\r\n  width: 140px;\r\n  height: auto;\r\n  border: 1px solid #1890FF;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n`;\r\n\r\nexport const TitleWrapper = styled.div`\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: space-between;\r\n  flex-wrap: wrap;\r\n  align-items: center;\r\n`;\r\n\r\nexport const DataSetTitle = styled.div`\r\n  margin-top: 20px;\r\n  height: auto;\r\n  width: 648px;\r\n`;\r\n\r\n// 是否已经标注\r\n// 撤销笔画\r\n// 跳转到哪一个字（记录个人标注的进度）+ 30/111","import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport axios from 'axios';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport './App.css';\n\nimport strokesData from './config/strokes-detail.json';\n\nimport {\n  Wrapper,\n  RightWrapper,\n  StrokeShow,\n  LeftWrapper,\n  CharacterWrapper,\n  FunctionWrapper,\n  HistoryWrapper,\n  Character,\n  ButtonWrapper,\n  StrokeNameList,\n  TitleTextSpan,\n  ContextRegularSpan,\n  ImageContainer,\n  TitleWrapper,\n  DataSetTitle,\n  TitleTextSpan2\n} from './style';\n\nimport { Tooltip, Result, Button, Radio, Progress, Image, Descriptions, Badge, message, Input, Spin, Alert } from 'antd';\n\nimport { UserOutlined } from '@ant-design/icons';\n\nconst TextRegular = (text) => {\n  return (\n    <ContextRegularSpan>{text}</ContextRegularSpan>\n  )\n}\n\nconst App = () => {\n  // useRef Hooks\n  const canvasRef = useRef(null);\n  \n  // useState Hooks\n  const [ currentStroke, setCurrentStroke ] = useState({});\n  const [ currentChar, setCurrentChar ] = useState({});\n  const [ strokeList, setStrokeList ] = useState({});\n  const [ strokeIndex, setStrokeIndex ] = useState(1); // 现在是第几个笔画\n  const [ strokeCompleted,  setStrokeCompleted] = useState(false); // 记录是否完成当前字\n  const [ systemInfo, setSystemInfo ] = useState({});\n  const [ result, setResult ] = useState([]);\n  const [ tempPoints, addPoints ] = useState([]);\n  const [ currentAuthor, setCurrentAuthor ] = useState([]);\n  const [ total, setTotal ] = useState(999); \n  const [ fullComplete, setFullComplete ] = useState(false);\n  const [ submitSuccess, setSubmitSuccess ] = useState(false);\n\n  // Loading\n  const [ sysInfoLoading, setSysInfoLoading ] = useState(true);\n  const [ currentCharLoading, setCurrentCharLoading ] = useState(true);\n  const [ strokeListLoading, setStrokeListLoading ] = useState(true);\n  const [ submitLoading, setSubmitLoading ] = useState(false);\n  const [ saveLoading, setSaveLoading ] = useState(false);\n  \n  const canvasClear = useCallback(() => {\n    if (fullComplete) return;\n    const canvas = canvasRef.current;\n    const ctx = canvas.getContext(\"2d\");\n    ctx.clearRect(0, 0, 256, 256);\n    addPoints(() => []);\n  }, [ canvasRef, fullComplete ]);\n\n  // useEffect Hooks\n    // init char\n  useEffect(() => {\n    (async () => {\n      setSysInfoLoading(() => true);\n      const reqResult = await axios('http://localhost:4000/api/system-info');\n      setSystemInfo(() => reqResult.data);\n      setSysInfoLoading(() => false);\n    })();\n    canvasClear(); // 顺便清空一下canvas\n  }, [ canvasClear, submitSuccess ]);\n    // 重新获取字的信息和笔画的信息\n  useEffect(() => {\n    if (sysInfoLoading) return;\n    if (fullComplete) return;\n    (async () => {\n      setCurrentCharLoading(() => true);\n      const reqResult = await axios('http://localhost:4000/api/character-info?id=' + systemInfo.currentImageId);\n      setCurrentChar(() => reqResult.data.img);\n      setTotal(() => setTotal(reqResult.data.total));\n      setCurrentCharLoading(() => false);\n      setSubmitSuccess(() => false);\n      setStrokeIndex(() => 1);\n      setStrokeCompleted(() => false);\n      setResult(() => []);\n      setCurrentAuthor(() => systemInfo.author);\n    })();\n  }, [ sysInfoLoading, systemInfo, fullComplete ]);\n    // 如果获取了字的信息，那么更新笔画的信息\n  useEffect(() => {\n    if (currentCharLoading) return;\n    if (fullComplete) return;\n    (async () => {\n      setStrokeListLoading(() => true);\n      const reqResult = await axios('http://localhost:4000/api/strokes-list?id=' + currentChar.cId);\n      setStrokeList(() => reqResult.data);\n      setStrokeListLoading(() => false);\n    })();\n  }, [ currentCharLoading, currentChar, fullComplete ]);\n    // 笔画列表动了，那笔画进度肯定要清零。\n  useEffect(() => {\n    setStrokeIndex(() => 1);\n  }, [ strokeList ]);\n    // 笔画进度一旦修改，那么当前笔画一定要更新，缓存数据要清零\n  useEffect(() => {\n    if (strokeListLoading) return;\n    setCurrentStroke(() => strokesData.strokes.find(stroke => stroke.id === strokeList[strokeIndex-1]));\n    addPoints(() => []);\n  }, [ strokeListLoading, strokeIndex, strokeList ]);\n\n  useEffect(() => {\n    if (strokeCompleted) {\n      message.success(\"该字已完成\")\n    }\n  }, [ strokeCompleted ]);\n\n  useEffect(() => {\n    console.log(systemInfo.currentImageId, total);\n    if (systemInfo.currentImageId === total) {\n      // message.success(\"全部完成啦！\");\n      setFullComplete(() => true);\n    }\n  }, [ submitSuccess ]);\n\n  const Paint = (e) => { // 每次点击canvas\n    if (tempPoints.length + 1 > currentStroke.strokeOrderLength) {\n      message.error('关键点数量溢出，请检查数量');\n      return;\n    }\n    const canvas = canvasRef.current;\n    const { left, top } = canvas.getBoundingClientRect();\n    const x = e.clientX - left, y = e.clientY - top;\n    const ctx = canvas.getContext(\"2d\");\n    ctx.lineWidth = 4;\n    ctx.beginPath();\n    ctx.arc(x, y, 5, 0, 2*Math.PI);\n    ctx.strokeStyle = \"magenta\";\n    ctx.fillStyle = \"magenta\";\n    ctx.stroke();\n    addPoints(() => {\n      return [...tempPoints, [x, y]];\n    });\n  }\n\n\n  const nextStroke = () => {\n    if (strokeCompleted) {\n      message.warning(\"已经录入完成所有笔画，请进入下一个字\");\n      return;\n    }\n    if (tempPoints.length !== currentStroke.strokeOrderLength) {\n      message.warning(\"关键点录入未完成\");\n      return;\n    }\n    const thisStroke = {\n      id: currentStroke.id,\n      name: currentStroke.name,\n      record: tempPoints\n    }\n    canvasClear();\n    setResult(() => [...result, thisStroke]);\n    if (strokeIndex < strokeList.length) {\n      setStrokeIndex(strokeIndex => strokeIndex + 1);\n    } else {\n      setStrokeCompleted(true);\n    }\n  };\n\n  const reStartChar = () => {\n    canvasClear();\n    setResult(() => []);\n    setStrokeCompleted(() => false);\n    setStrokeIndex(() => 1);\n  };\n\n  const submitChar = (skip) => {\n    if (!strokeCompleted && !skip) {\n      message.warning(\"笔画数量未达到预设标准\");\n      return;\n    }\n    setSubmitLoading(() => true);\n    let myDate = new Date();\n    (async () => {\n      const ans = {\n        dataSetId: systemInfo.dataSetId,\n        currentImageId: systemInfo.currentImageId,\n        author: currentAuthor,\n        charId: currentChar.id,\n        skip,\n        charName: currentChar.name,\n        date: myDate.toLocaleString(),\n        result\n      }\n      const reqResult = await axios.post('http://localhost:4000/api/submit', ans);\n      (reqResult.data === \"success\") && setSubmitSuccess(() => true);\n      setSubmitLoading(() => false);\n    })();\n  };\n\n  const saveData = () => {\n    setSaveLoading(() => true);\n    (async () => {\n      const ans = {\n        dataSetId: systemInfo.dataSetId,\n        author: currentAuthor\n      }\n      const reqResult = await axios.post('http://localhost:4000/api/save-data', ans);\n      if (reqResult.data === \"success\") {\n        message.success(`已经保存至${ans.dataSetId}.json`)\n        setTimeout(() => {\n          window.location.reload();\n        }, 1000);\n      }\n    })();\n    setSaveLoading(() => false);\n  };\n\n  useHotkeys('c', () => nextStroke(), {}, [ strokeCompleted, tempPoints, currentStroke, result, strokeList, strokeIndex ]);\n  useHotkeys('z', () => canvasClear());\n  useHotkeys('x', () => reStartChar());\n  useHotkeys('h', () => submitChar(true), {}, [ strokeCompleted, systemInfo, currentChar, currentAuthor ]);\n  useHotkeys('v', () => submitChar(false), {}, [ strokeCompleted, systemInfo, currentChar, currentAuthor ]);\n\n\n  return (\n    <Wrapper>\n      {\n        fullComplete ? (\n          <Result\n            style={{margin: 'auto'}}\n            status=\"success\"\n            title=\"当前数据集已标注完成\"\n            extra={[\n              <Tooltip placement=\"bottom\" title={`将结果保存为\"data_${systemInfo.dataSetId}.json\"，并进入下一个数据集`}>\n                <Button type=\"primary\" onClick={() => saveData()}>\n                  保存数据文件\n                </Button>\n              </Tooltip>,\n              saveLoading ? (<Spin />) : null \n            ]}\n          />\n        ) : (\n          <>\n            <LeftWrapper>\n              <StrokeNameList>\n                <span style={{ fontSize: \"25px\", margin: \"10px\" }}>笔画列表（自动选择）</span>\n                {\n                  strokeListLoading ? (\n                    <Spin tip=\"Loading...\">\n                      <Alert\n                        message=\"strokeList\"\n                        description=\"strokeList strokeList strokeList strokeList strokeList strokeList \"\n                        type=\"info\"\n                      />\n                    </Spin>\n                  ) : (\n                    <Radio.Group \n                      style={{margin: \"17px\" }}\n                      value={strokeList[strokeIndex-1]} size=\"large\" buttonStyle=\"solid\">\n                      {\n                        strokesData.strokes.map((item) => {\n                          return (\n                            <Radio.Button key={`stroke_${item.id}`} value={item.id} \n                              onClick={() => message.warning(\"目前不允许修改笔顺，请修改配置文件适配\")}\n                            >\n                              { item.name }\n                            </Radio.Button>\n                          )\n                        })\n                      }\n                    </Radio.Group>\n                  )\n                }\n              </StrokeNameList>\n              <StrokeShow>\n                { \n                  currentCharLoading ? (\n                    <Spin tip=\"Loading...\">\n                      <Alert\n                        message=\"currentChar\"\n                        description=\"currentChar currentChar currentChar currentChar currentChar currentChar\"\n                        type=\"info\"\n                      />\n                    </Spin>\n                  ) : (\n                    <Descriptions \n                      style={{ height: \"auto\", width: \"650px\", padding: \"20px\", \n                        border: \"1px solid black\",\n                        borderRadius: \"10px\",\n                        borderTop: \"1px solid white\"}}\n                      title={\n                        <TitleWrapper>\n                          <TitleTextSpan>当前笔画信息：{`${currentStroke.id} - ${currentStroke.name}`} </TitleTextSpan>\n                          <div>\n                            {TextRegular(`关键点标记进度[${tempPoints.length}/${currentStroke.strokeOrderLength}]: `)}\n                            <Progress percent={(tempPoints.length/currentStroke.strokeOrderLength)*100} steps={currentStroke.strokeOrderLength} showInfo={false}/>\n                          </div>\n                        </TitleWrapper>\n                      } \n                      bordered\n                    >\n                      <Descriptions.Item label={TextRegular('笔画示意图')}>\n                        <ImageContainer>\n                          <Image src={`/assets/stroke-example/${currentStroke.strokeOrderImageUrl}`} />\n                        </ImageContainer>\n                      </Descriptions.Item>\n                      <Descriptions.Item label={TextRegular('节点分布图')} span={2}>\n                        <ImageContainer>\n                          <Image src={`/assets/stroke-order/${currentStroke.strokeOrderImageUrl}`} />\n                        </ImageContainer>\n                      </Descriptions.Item>\n                    </Descriptions>\n                  )\n                } \n              </StrokeShow >\n            </LeftWrapper>\n            <RightWrapper>\n                  {\n                    sysInfoLoading && currentCharLoading ? (\n                    <Spin tip=\"Loading...\">\n                      <Alert\n                        message=\"sysInfo, currentChar\"\n                        description=\" \"\n                        type=\"info\"\n                      />\n                    </Spin>\n                    ) : (\n                      <DataSetTitle>\n                        <TitleWrapper>\n                          <TitleTextSpan>\n                            数据集：{systemInfo.dataSetId}号\n                          </TitleTextSpan>\n                          <Input \n                            style={{ width: '40%' }} \n                            size=\"large\" \n                            placeholder=\"请填写记录人\" \n                            prefix={<UserOutlined />} \n                            value={currentAuthor} \n                            onChange={e => setCurrentAuthor(() => e.target.value)}\n                          />\n                        </TitleWrapper>\n                        <TitleTextSpan2><Badge status=\"processing\" />当前字：\"{currentChar.name}\"，进度：{systemInfo.currentImageId}/{total}</TitleTextSpan2>\n                      </DataSetTitle>\n                    )\n                  }\n              <CharacterWrapper>\n                <FunctionWrapper>\n                  <span>请在红框内进行标记</span>\n                  <Character>\n                    {\n                      sysInfoLoading ? (\n                      <Spin tip=\"Loading...\">\n                        <Alert\n                          message=\"sysInfo\"\n                          description=\"sysInfo sysInfo sysInfo sysInfo \"\n                          type=\"info\"\n                        />\n                      </Spin>\n                      ) : (\n                        <img \n                          alt=\"没有此图片~请检查数据集是否已全部完成\"\n                          style={{\n                            left: \"0px\",\n                            position: \"absolute\"\n                          }}\n                          src={currentChar ? (`http://localhost:4000/${systemInfo.dataSetId}/${currentChar.fileName}`) : null}\n                        >\n                        </img>\n                      )\n                    }\n\n                    <canvas\n                      width=\"256px\"\n                      height=\"256px\"\n                      ref={canvasRef}\n                      onClick={e => Paint(e)}\n                    >\n                    </canvas>\n                  </Character>\n                  <ButtonWrapper>\n                    <Button \n                      size=\"large\" \n                      type=\"primary\" \n                      onClick={() => nextStroke()}\n                      disabled={(tempPoints.length !== currentStroke.strokeOrderLength) || (strokeCompleted)}\n                    >下一个笔画（C）</Button>\n                    <Button size=\"large\" onClick={canvasClear}> 清空该笔画关键点（Z）</Button>\n                    <Button size=\"large\" danger onClick={reStartChar}>重新开始本字（X）</Button>\n                    <Button size=\"large\" type=\"dashed\" danger onClick={() => submitChar(true)}>本字难以辨认，跳过（H）</Button>\n                  </ButtonWrapper>\n                </FunctionWrapper>\n                <HistoryWrapper>\n                  <ContextRegularSpan\n                    style={{\n                      margin: 10,\n                      borderBottom: '2px solid black'\n                    }}\n                  >\n                    输出结果<br></br>\n                  </ContextRegularSpan>\n                  <div style={{ overflow: \"scroll\", height: \"340px\", width: \"100%\"}}>\n                  { \n                    strokeListLoading ? (\n                      <Spin tip=\"strokeList\">\n                      </Spin>\n                    ) : (\n                        result.map((item, index) => {\n                          return (\n                              <div key={index} style={{ fontSize: \"18px\", display: \"flex\", flexDirection: \"column\", alignItems: \"center\" }}> \n                                <span>\n                                  ({index + 1}) {item.name}\n                                </span>\n                                <span\n                                  style={{\n                                    margin: 5,\n                                    borderBottom: '1px solid gray'\n                                  }}\n                                >\n                                  <div \n                                  >\n                                    {\n                                      item.record.map((item2, index2) => {\n                                        return (\n                                          <span key={index2}> ({item2[0]}, {item2[1]})</span>\n                                        )\n                                      })\n                                    }\n                                  </div>\n                                </span>\n                              </div>\n                          )\n                        })\n                    )\n                  }\n                  </div>\n                  <div>\n                    <Progress style={{margin: \"10px\"}} type=\"circle\" status={ submitSuccess ? null : \"active\"} percent={\n                      strokeCompleted ? 100 : (((strokeIndex-1)/strokeList.length)*100)\n                    } width={80} />\n                    { submitLoading ? (<Spin />) : null }\n                  </div>\n                  <Button \n                    size=\"large\" type=\"primary\" \n                    onClick={() => submitChar(false)} \n                    disabled={!strokeCompleted}\n                  >\n                    提交本字（V）\n                  </Button>\n                </HistoryWrapper>\n              </CharacterWrapper>\n            </RightWrapper>\n          </>\n        )\n      }\n    </Wrapper>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nReactDOM.render(\n  <App />,\n  document.getElementById('root')\n);\n\n"],"sourceRoot":""}